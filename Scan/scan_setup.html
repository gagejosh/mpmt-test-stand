!DOCTYPE html>
<html class="mcss">
<head>
   <meta charset="UTF-8">
   <link rel="stylesheet" href="midas.css">
   <script src="controls.js"></script>
   <script src="midas.js"></script>
   <script src="mhttpd.js"></script>
   <title>Scan Setup</title>

   <style>
      .mtable td { padding: 10px; }
   </style>

   <script>
   var gStatusInflight = false;
   function statusPeriodicUpdate(){

      // don't make another request if the last request is still outstanding.
      if(gStatusInflight) return;     
      gStatusInflight = true;

      // Get padiwa values
      mjsonrpc_send_request([
         mjsonrpc_make_request("db_get_values",{"paths":["/Equipment/Scan/Variables"]}),
      ]).then(function (rpc) {         
         

        //console.log(parseInt(rpc[0].result.data[0].scan[2]));
        document.getElementById("progressbar").setAttribute("data-max-value",parseInt(rpc[0].result.data[0].scan[2]))
//        document.getElementById("progressbar").setAttribute("data-max-value",200)

      }).catch(function(error) {
         if (error.request) {
            var s = mjsonrpc_decode_error(error);
            console.log("mjsonrpc_error_alert: " + s);
         } else {
            console.log("mjsonroc_error_alert: " + error);
         }
      });
   }

  </script>



</head>

<body class="mcss" onload="statusPeriodicUpdate();mhttpd_init('Scan Setup'); setInterval(statusPeriodicUpdate,5000);statusPeriodicUpdate();">

<!-- header and side navigation will be filled in mhttpd_init -->
<div id="mheader"></div>
<div id="msidenav"></div>

<div id="mmain">

  <table class="mtable">
    <tr>
      <th colspan="2" class="mtableheader">Scan Setup</th>
    </tr>
    <tr>
      <td>
        Step Size (mm)
      </td>
       <td >       
        <div class="modbvalue" data-odb-editable="1" data-odb-path="/Equipment/Scan/Settings/StepSize" ></div> 
      </td>
    </tr>
    <tr>
      <td>
        Starting Position (mm) [X,Y]
      </td>
       <td >       
        <div class="modbvalue" data-odb-editable="1" data-odb-path="/Equipment/Scan/Settings/StartPosition[0]" ></div>
        <div class="modbvalue" data-odb-editable="1" data-odb-path="/Equipment/Scan/Settings/StartPosition[1]" ></div> 
      </td>
    </tr>
    <tr>
      <td>
        Scan Distance (mm) [X,Y]
      </td>
       <td >       
        <div class="modbvalue" data-odb-editable="1" data-odb-path="/Equipment/Scan/Settings/Distance[0]" ></div>
        <div class="modbvalue" data-odb-editable="1" data-odb-path="/Equipment/Scan/Settings/Distance[1]" ></div> 
      </td>
    </tr>
    <tr>
      <td>
        Scan Time at each Point (ms)
      </td>
       <td >       
        <div class="modbvalue" data-odb-editable="1" data-odb-path="/Equipment/Scan/Settings/ScanTime" ></div> 
      </td>
    </tr>
  </table>

  <table class="mtable">
    <tr>
      <th colspan="2" class="mtableheader">Scan Status</th>
    </tr>
    <tr>
      <td>
        Total number of points
      </td>
       <td >       
        <div class="modbvalue" data-odb-editable="1" data-odb-path="/Equipment/Scan/Variables/SCAN[2]" ></div> 
      </td>
    </tr>
    <tr>
      <td>
        Current point
      </td>
       <td >       
        <div class="modbvalue" data-odb-editable="1" data-odb-path="/Equipment/Scan/Variables/SCAN[1]" ></div> 
      </td>
    </tr>

    <tr>
      <th colspan="2" style="text-align: left;"> 
	<div id="progressbar" class="modbhbar" style="width:300px;height:20px;color:orange;" 
	     data-odb-path="/Equipment/Scan/Variables/SCAN[1]"
             data-min-value="0" data-max-value="10" data-print-value="1"></div>
      </th>
    </tr>

  </table>

</body>
</html>
